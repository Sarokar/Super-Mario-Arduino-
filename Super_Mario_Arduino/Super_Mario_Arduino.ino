#include <Adafruit_GrayOLED.h>
#include <gfxfont.h>
#include <Adafruit_GFX.h>
#include <Adafruit_SPITFT.h>
#include <Adafruit_SPITFT_Macros.h>
//#include <Vector2.hpp>
#include <SPI.h>
#include <Adafruit_GFX.h>
#include <Adafruit_PCD8544.h>


// Declare LCD object for software SPI
// Adafruit_PCD8544(CLK,DIN,D/C,CE,RST);
Adafruit_PCD8544 display = Adafruit_PCD8544(7, 6, 5, 4, 3);

//mario position
unsigned long playerX;
unsigned long playerY;
unsigned int mapWidth = 0;
unsigned int i;
unsigned int minY;
unsigned int mapTaype = 1;

unsigned int mapWidth1;
unsigned int mapWidth2;
bool yesCol = 0;
unsigned int dist = 10;

//inputx
bool mvmt = 0;
unsigned int jump = 0;
bool iteration = 0;
int statusA = 0;
signed int VRx = A1;
signed int VRy = A0;
 unsigned int xPosition = 0;
 unsigned int xPosition2 = 0;
unsigned int yPosition = 0;
signed int xDir = 0;
signed int offset = 4;
signed int yoffset = 10;
int last_posX = 1;
bool inAir = 0;
int last_posY = display.height()-18;
//Vector2f player_pos(0,display.height()-18);

unsigned int yDir=0;
unsigned int start = 0;
unsigned int rBound = 80;
unsigned int moveDir = 0;
unsigned int jmpFrame = 0;
#define a2 A2

unsigned int xMax  = display.width()/2+2;
unsigned int xMin  = 0;



const unsigned char map1 [] PROGMEM = {
  0xff, 
  0x89, 
  0x89, 
  0xff, 
  0x91, 
  0x91, 
  0x91, 
  0xff};

const unsigned char map2 [] PROGMEM = {
0xff, 
0x47, 
0x47, 
0x47, 
0x47, 
0xff, 
0x26, 
0x26};

const unsigned char MarioLeft [] PROGMEM = {
0x00, 0x00, 0x07, 0xe0, 0x18, 0x10, 0x23, 0xc8, 0x1d, 0x38, 0x21, 0x64, 0x22, 0x64, 0x1f, 0x18, 
  0x08, 0x30, 0x07, 0xc8, 0x09, 0x84, 0x0f, 0xf4, 0x0d, 0x88, 0x0e, 0x48, 0x04, 0x30, 0x03, 0xe0
};

const unsigned char clearFrame [] PROGMEM = {
  0x00, 0x00, 
  0x00, 0x00 
};

const unsigned char marioJump [] PROGMEM = {
  0x07, 0xce, 
  0x08, 0x31, 
  0x11, 0xc9, 
  0x1e, 0xba, 
  0x26, 0x86, 
  0x26, 0x46, 
  0x18, 0xfc, 
  0x0c, 0x14, 
  0x3f, 0xe8, 
  0x71, 0x9e, 
  0x89, 0x69, 
  0x8b, 0xf1, 
  0x7f, 0xf2, 
  0x8f, 0xf2, 
  0x9f, 0x8c, 
  0x6e, 0x00
};

const unsigned char marioWalk [] PROGMEM = {
  0x07, 0xc0, 
  0x08, 0x38, 
  0x13, 0xc4, 
  0x1c, 0xb8, 
  0x26, 0x84, 
  0x26, 0x44, 
  0x18, 0xf8, 
  0x1c, 0x10, 
  0x63, 0xf8, 
  0x91, 0x9c, 
  0x8b, 0xfa, 
  0x4f, 0x6a, 
  0x3f, 0xf4, 
  0x4f, 0xc4, 
  0x44, 0x88, 
  0x38, 0x70
};

const unsigned char marioLeft [] PROGMEM = {
  0x00, 0x00, 
  0x07, 0xe0, 
  0x18, 0x10, 
  0x23, 0xc8, 
  0x1d, 0x38, 
  0x21, 0x64, 
  0x22, 0x64, 
  0x1f, 0x18, 
  0x08, 0x30, 
  0x07, 0xc8, 
  0x09, 0x84, 
  0x0f, 0xf4, 
  0x0d, 0x88, 
  0x0e, 0x48, 
  0x04, 0x30, 
  0x03, 0xe0  
};

const unsigned char marioWalkLeft [] PROGMEM = {
 0x03, 0xe0, 
 0x1c, 0x10, 
  0x23, 0xc8, 
  0x1d, 0x38, 
  0x21, 0x64, 
  0x22, 0x64, 
  0x1f, 0x18, 
  0x78, 0x3e, 
  0x97, 0xc9, 
  0x99, 0x89, 
  0x5f, 0xca, 
  0x36, 0xfc, 
  0x2f, 0xfc, 
  0x23, 0xf2, 
  0x11, 0x22, 
  0x0e, 0x1c
};

const unsigned char marioJumpLeft [] PROGMEM = {
  0x73, 0xe0, 
  0x8c, 0x10, 
  0x93, 0x88, 
  0x5d, 0x78, 
  0x61, 0x64, 
  0x62, 0x64, 
  0x3f, 0x18, 
  0x28, 0x30, 
  0x17, 0xfc, 
  0x79, 0x8e, 
  0x96, 0x91, 
  0x8f, 0xd1, 
  0x4f, 0xfe, 
  0x4f, 0xf1, 
  0x31, 0xf9, 
  0x00, 0x76  
};

const unsigned char marioStandLeft [] PROGMEM = {
  0x00, 0x00, 
  0x07, 0xe0, 
  0x18, 0x10, 
  0x23, 0xc8, 
  0x1d, 0x38, 
  0x21, 0x64, 
  0x22, 0x64, 
  0x1f, 0x18, 
  0x08, 0x30, 
  0x07, 0xc8, 
  0x09, 0x84, 
  0x0f, 0xf4, 
  0x0d, 0x88, 
  0x0e, 0x48, 
  0x04, 0x30, 
  0x03, 0xe0
};

const unsigned char block1 [] PROGMEM = {
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x03, 0x00, 0x00, 0x00, 0x00, 
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0x00, 0x20, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
  0x00, 0x01, 0x00, 0x20, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0x80, 0x20, 0x00, 
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x80, 0x40, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
  0x00, 0x00, 0x00, 0x80, 0x40, 0x04, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x80, 0x40, 
  0x0c, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xc0, 0xc0, 0x08, 0x00, 0x00, 0x00, 0x00, 
  0x00, 0x00, 0x00, 0x00, 0x40, 0x80, 0x08, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x40, 
  0x80, 0x10, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x61, 0x80, 0x10, 0x00, 0x20, 0x00, 
  0x00, 0x00, 0x00, 0x00, 0x00, 0x21, 0x00, 0x30, 0x00, 0x20, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
  0x31, 0x00, 0x20, 0x00, 0x20, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x13, 0x00, 0x40, 0x00, 0x10, 
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x1a, 0x00, 0x40, 0x00, 0x10, 0x00, 0x00, 0x00, 0x00, 0x00, 
  0x00, 0x0a, 0x00, 0x80, 0x00, 0x10, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x0e, 0x00, 0x80, 0x00, 
  0x10, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x06, 0x01, 0x00, 0x00, 0x10, 0x00, 0x00, 0x00, 0x00, 
  0x00, 0x00, 0x06, 0x03, 0x00, 0x00, 0x10, 0x10, 0x00, 0x00, 0x00, 0x00, 0x00, 0x02, 0x02, 0x00, 
  0x00, 0x10, 0x30, 0x00, 0x00, 0x00, 0x00, 0x00, 0x03, 0x04, 0x00, 0x20, 0x10, 0x20, 0x00, 0x00, 
  0x00, 0x00, 0x00, 0x01, 0x0c, 0x00, 0x10, 0x10, 0x60, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0x08, 
  0x00, 0x10, 0x10, 0x40, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0x10, 0x00, 0x18, 0x10, 0xc0, 0x00, 
  0x00, 0x00, 0x00, 0x00, 0x01, 0x60, 0x00, 0x0c, 0x11, 0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 
  0xc0, 0x00, 0x06, 0x13, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x03, 0x00, 0x00, 0x03, 0x3e, 0x00, 
  0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0x00, 0x00, 0x01, 0xd0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
  0x01, 0x00, 0x00, 0x00, 0x78, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0x38, 
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0x08, 0x00, 0x00, 0x00, 0x00, 0x00, 
  0x00, 0x01, 0x00, 0x00, 0x00, 0x08, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 
  0x08, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0x04, 0x00, 0x00, 0x00, 0x00, 
  0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0x04, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0x00, 0x00, 
  0x00, 0x04, 0x00, 0x00, 0x00, 0x00, 0x00, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 
  0xff, 0xf0, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xf0, 0xff, 0xff, 0xff, 
  0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xf0, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 
  0xff, 0xff, 0xf0, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xf0, 0xff, 0xff, 
  0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xf0, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 
  0xff, 0xff, 0xff, 0xf0, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xf0, 0xff, 
  0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xf0, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 
  0xff, 0xff, 0xff, 0xff, 0xf0, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xf0, 
  0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xf0, 0xff, 0xff, 0xff, 0xff, 0xff, 
  0xff, 0xff, 0xff, 0xff, 0xff, 0xf0, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 
  0xf0, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xf0
};

const unsigned char block2 [] PROGMEM = {
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x7f, 0xff, 0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
  0x00, 0x7f, 0xff, 0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xff, 0xff, 0x00, 0x00, 0x00, 
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xff, 0xff, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
  0xff, 0xff, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xff, 0xff, 0x00, 0x00, 0x00, 
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
};

const unsigned char Mario [] PROGMEM = {
  0x00, 0x00, 
  0x07, 0xe0, 
  0x08, 0x18, 
  0x13, 0xc4, 
  0x1c, 0xb8, 
  0x26, 0x84, 
  0x26, 0x44, 
  0x18, 0xf8, 
  0x0c, 0x10, 
  0x13, 0xe0, 
  0x21, 0x90, 
  0x2f, 0xf0, 
  0x11, 0xb0, 
  0x12, 0x70, 
  0x0c, 0x20, 
};


struct Collisions {
  unsigned int xCor;
  unsigned int yCor;  
};

struct Collisions allCol[4];

void checkCollisions() {
//  Serial.println("Collision Start");
  for (unsigned int l = 0; l<4; l++) {
//    Serial.println("Collsion1");
//     Serial.println("i: ");
//     Serial.print(l);
    //Serial.println(last_posX);
    if ((allCol[l].xCor == last_posX) || (allCol[l].xCor+16 >= last_posX)) {
//      Serial.println("Collsion2");
//       Serial.println(allCol[l].yCor);
//       Serial.println(last_posY);
      if (allCol[l].yCor > last_posY-1) {
//        Serial.println("Collision Detected");
        //a elevated platform is present
        minY = allCol[l].yCor;
//        Serial.println(minY);
        yesCol = 1;
        break;
      }
      
    }
    else {
      //Falls
//       Serial.println(last_posX);
//      Serial.println("netural");
//      if (mapType == 1) {
        minY = display.height()-18;
//      }

      //map with fall
//      if (mapType == 2) {
//        minY = display.height()-18;
//      }
//      last_posY = display.height()-18;
      //break;
    }
       
  }
  
}

void drawPlayer() {
  //non jumping animations
  if (!inAir) {
    
    if (xDir == 0) {
        display.drawBitmap(last_posX, minY,  Mario, 16, 16, 1);  
//        display.drawBitmap(21, 18,  Mario, 16, 16, 1); 
//        display.drawBitmap(45, 10,  Mario, 16, 16, 1);   
//        display.drawBitmap(20, 25,  Mario, 16, 16, 1); 
//        Serial.println(last_posX);
//        Serial.println(last_posY);
      }
    //walking to the right
    
    else if (xDir == 1) {
      display.drawBitmap(last_posX, minY,  marioWalk, 16, 16, 1);
//      Serial.println(last_posX);
      xDir = 0;
      //dist++;
    }
    //walking to the left
    else {
      if (!mvmt) {
        display.drawBitmap(last_posX, minY,  marioStandLeft, 16, 16, 1);
      }
      else {
        display.drawBitmap(last_posX, minY,  marioWalkLeft, 16, 16, 1);  
        mvmt = 0;
       // dist--;
      }     
    }
  }
  else {
    if (jmpFrame <= 2) {
//      Serial.println("first 2 jmp frame should display twice: ");
//      Serial.println(last_posY);
      
      if ((xDir == 1) || (xDir == 0)) {
//         Serial.println("Display Jump");
        display.drawBitmap(last_posX, last_posY,  marioJump, 16, 16, 1);
      }
      if (xDir == -1) {
//        Serial.println("Jump Left 1");
//        Serial.println(last_posX);
        display.drawBitmap(last_posX, last_posY,  marioJumpLeft, 16, 16, 1);
      }
      
      jmpFrame += 2;  
      }
   // }
    //jmpFrame++;
    if (jmpFrame > 2) {
//      Serial.println("last 2 jmp frame should display twice: ");
      
      if (jmpFrame == 4) {
        //Serial.println("jmp=2");
        yDir = 0;
      }
       // reset y movement
      jmpFrame += 2; 
      //Serial.println(jmpFrame); 
      
      last_posY += 10;
      if (yesCol) {
//        Serial.println("yesCol");
        playerY = minY;
        last_posY = minY;
      }
      if (!yesCol) {
//        Serial.println("!yesCol");
        playerY = last_posY;
      }
//      Serial.println(last_posY);
      
      if ((xDir == 1) || (xDir == 0)) {
//        Serial.println("Draw final col");
//        Serial.println(minY);
        display.drawBitmap(last_posX, minY,  marioJump, 16, 16, 1);
      }
      if (xDir == -1) {
//        Serial.println("Jump Left 2");
//        Serial.println(last_posX);
        display.drawBitmap(last_posX, minY,  marioJumpLeft, 16, 16, 1);
      }
      
      if (jmpFrame >= 8) {
        inAir = 0;
        jmpFrame = 0;
      }
    }
  }
  //Serial.println("Player Drawn");
}

void drawMap() {
  if (dist < 23) {
//    display.drawBitmap(mapWidth+6, -24,  block1, 84, 84, BLACK);
    display.drawBitmap(mapWidth+6, -24,  block2, 84, 84, BLACK);
//    display.drawBitmap(mapWidth-8, -24,  block1, 84, 84, BLACK);
//    display.drawBitmap(mapWidth+76, -24,  block1, 84, 84, BLACK);
    //display.drawBitmap(mapWidth-12, -24,  block1, 84, 84, BLACK);
//    display.drawBitmap(mapWidth+72, -24,  block1, 84, 84, BLACK);
  }
  if ((dist > 23)) {
//    mapWidth-=4;
//    if (xDir == -1) {
     // Serial.println("Draw EVE");
      display.drawBitmap(mapWidth+8, -24,  block2, 84, 84, BLACK);
      display.drawBitmap(mapWidth+76, -24,  block1, 84, 84, BLACK);
//    }
//    else {
//      display.drawBitmap(mapWidth+8, -24,  block1, 84, 84, BLACK);
//      display.drawBitmap(mapWidth+76, -24,  block1, 84, 84, BLACK);
//    }
    
    //display.drawBitmap(mapWidth, -24,  block1, 84, 84, BLACK);  
//    display.drawBitmap(mapWidth-84, -24,  block1, 84, 84, BLACK);
  }
//  if (dist > 42) {
//    display.drawBitmap(mapWidth+8, -24,  block1, 84, 84, BLACK);
//      display.drawBitmap(mapWidth+76, -24,  block1, 84, 84, BLACK);
//  }
}



typedef struct task {
  int state;
  unsigned long period;
  unsigned long elapsedTime;
  int (*TickFct)(int);
} task;

const unsigned short tasksNum = 1;
task tasks[tasksNum];

enum Player_States {Player_init,Player_draw,Player_movement, Player_Move,Player_yMove, Player_update};

int TickFct_Player(int state) { 
  switch(state) {
    case Player_init:
    
    break;

    case Player_update:
       display.clearDisplay(); 
       //TODO: drawMap

        drawMap();
        drawPlayer();
        

        //mid Air
        if (yDir == 1) {
          state = Player_Move;
//          Serial.println("Mid air");
          break;
        }
//       Serial.println("y:");
//       Serial.println(last_posY);
        //movement is present
        //Serial.println(xPosition);
        if (digitalRead(a2) == HIGH) {
          Serial.println("HIGH");
          delay(300);
          if (digitalRead(a2) == LOW) {
            Serial.println("LOW");
            yDir = 1; //recognize a jump is happening 
            inAir = 1;
            state = Player_Move;
            //break;
            
          }
          //mvmt = 1;
        }
        
        if ((analogRead(VRx) > 900)) {
          Serial.println("Right Joystick Detected");
          dist++;
          //Serial.println(dist);
          xDir = 1;
          mvmt = 1;
          state = Player_Move;
          //break;
        }
        
        if (analogRead(VRx) < 100) {
          xDir = -1;
          if (dist > 8) {
            dist--;
          }
          mvmt = 1;
          //Serial.println(dist);
          state = Player_Move;
          
          break;  
        }

       

    break;

    case Player_draw:

    break;

//    case Player_movement:
//       //Serial.println("Player_movement1");
//
//      //todo: input controls
//      xPosition = analogRead(VRx);
//      yPosition = analogRead(VRy);
//      //Serial.println(xPosition);
//      //start = 0;
//      
//      
//      //right movement
//      if (xPosition > 800) {
//        break;
//      }
//
//      if (xPosition < 450) {
//        Serial.println("xmove1L");
//        xDir = -1; // movement left
//        //Serial.println(xDir);
//        mvmt = 1;
//        //mvmt = 1;
//        state = Player_Move;
//        break;
//
//        
//      }
//      Serial.println("y dire: ");
//     // Serial.print(xDir);
//      if (digitalRead(a2) == HIGH) {
//        Serial.println("Jump Detected");
//        yDir = 1;
//        mvmt = 1;
//        state = Player_yMove;
//        break;
//      }
//      xDir = 0;
//      moveDir = 0;
//      state = Player_draw;
//    break;
//
//    case Player_yMove:
//    break;

    default:
    break;
    }




    

  switch(state) {
    case Player_init:
      //default position left of the screen
      //Serial.println("Player_init2");
      Serial.println("Successful init");
      
      playerX = 1;
      playerY = display.height()-18;
      minY = playerY;
       //int z = 10;

      state = Player_update;
    break;

    case Player_draw:
      
      state = Player_movement;
    break;

    case Player_Move:
        //Serial.println("Calculate Movement");
        //last_posX = ((playerX*0.6)/8);
        if ((xDir != 0) || ((xDir == -1) && (mvmt == 0))) {
//          Serial.println("Distance: ");
//          Serial.println(dist);
          Serial.println("X: ");
          Serial.println(last_posX);
          if ((dist > 8) && (dist < 23)) {
//            Serial.println("yur");
            offset *= xDir;
            last_posX = playerX+offset;
    //        last_posX *= xDir;
            playerX = last_posX;
            offset *= xDir;
          }
          
          if (dist>23) {
//            if ((dist == 47) || (dist == 42)) {
            if (dist == 42) {
              mapWidth = 0;
            }
            if (xDir == 1) {
              mapWidth-=4;
            }
            if (xDir == -1) {
//              Serial.println("print back");
              mapWidth+=4;
            }
          }
        }

        if (yDir == 1) {
//          Serial.println("Calculate Y");
//          Serial.println(last_posY);
//          Serial.println(playerY);
          //offset *= yDir;
          last_posY = playerY-(yoffset);
//          Serial.println(last_posY);
          playerY = last_posY;
//          Serial.println(last_posY);
          //offset *= yDir;  
        }
        checkCollisions();
        state = Player_update;
        //Serial.println(last_posX);
    break;

    default:
    break;
    }

    return state;
}
 
 

    
  


void setup() {
   xPosition = analogRead(VRx);
      yPosition = analogRead(VRy);
  pinMode(VRx, INPUT);
  pinMode(VRy, INPUT);
  pinMode(a2, INPUT);
  
  i = 0;
  tasks[i].state = Player_init;
  tasks[i].period = 50;
  tasks[i].elapsedTime = 0;
  tasks[i].TickFct = &TickFct_Player; 
  
  // Print a message to the LCD.
  //lcd.print("hello, world!");
}

void loop() {
  // set the cursor to column 0, line 1
  // (note: line 1 is the second row, since counting begins with 0):
  // print the number of seconds since reset:
   Serial.begin(9600);

  //Initialize Display
  display.begin();
  allCol[0].xCor = 1;
  allCol[0].yCor = 25;
//  allCol[1].xCor = 5;
//  allCol[1].yCor = 25;
//  allCol[2].xCor = 9;
//  allCol[2].yCor = 25;
//  allCol[3].xCor = 13;
//  allCol[3].yCor = 25;
//  allCol[4].xCor = 17;
//  allCol[4].yCor = 25;
  
  allCol[1].xCor = 25;
  allCol[1].yCor = 17;
  allCol[2].xCor = 45;
  allCol[2].yCor = 10;
//  allCol[6].xCor = 25;
//  allCol[6].yCor = 17;
//  allCol[7].xCor = 29;
//  allCol[7].yCor = 17;
//  allCol[8].xCor = 33;
//  allCol[8].yCor = 17;
//  allCol[9].xCor = 37;
//  allCol[9].yCor = 17;
//  allCol[10].xCor = 41;
//  allCol[10].yCor = 17;
//  allCol[11].xCor = 44;
//  allCol[11].yCor = 17;

  // you can change the contrast around to adapt the display for the best viewing!
  display.setContrast(57);

  if (statusA == 0) {
  display.clearDisplay();
    statusA++;
  }
  //Serial.println("start");
  
  for (i = 0; i < tasksNum; ++i) {
    if ( (millis() - tasks[i].elapsedTime) >= tasks[i].period) {
        tasks[i].state = tasks[i].TickFct(tasks[i].state);
        tasks[i].elapsedTime = millis(); // Last time this task was ran
    }
  }
  delay(200);
}
